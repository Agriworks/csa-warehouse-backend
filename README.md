# CSA Data Warehouse

There are two components to this backend: read-only datastore frontend and an API for business dashboards.

Data store - This is a read-only portal that combines DocTypes from multiple ERPNext instances as a on-stop solution for CSA employees. Requirement is for CSA employee to be able to login into all of the ERP systems they have access to and view documents. This backend retrieves data from the servers via ERPNext API and stores in a MongoDB cloud instance on a daily basis. The backend also sets up a REST API for the frontend to access the database.

Business dashboards API (TODO) - This is a cleanup and aggregation pipeline that runs on the raw data pulled into the database. We set up data transformation rules based on dashboard requirements that write into the business database. We also set up a REST API for the dashboards to access this transformed data.


## Roadmap

- Add API for listing doctypes for a given ERP instance.
- Move from password authentication to API key and secret.
- Ingestion is currently done in a single thread. It needs to be partitioned so one error doesn't derail the whole process.
- Business dashboards transformation rules.

## Project Structure

ingestion.py: cloud function script that pulls data from ERPNext server and stores in database. Will be run on a daily basis.
main.py: FastAPI app initialization and root endpoints
routers/: API endpoint definitions
crud/: Data access logic
models/: Pydantic models for data validation and serialization (in progress)
core/: Database connections

## Storage Structure

- Separate collection for each ERP instance, eg: erp_kisanmitra
- Document structure within each collection: {
  "_id": ObjectId("..."), // automatically generated by MongoDB
  "doctype": "DocTypeName", // e.g., "Purchase Invoice"
  "document_data": { ... } // Full JSON retrieved from ERPNext
}

## Getting Started

Create a .env file in the following template:

ERP_USERNAME = "your email"

ERP_PASSWORD = "your password"

MONGODB_URI = "mongodb+srv URL"

MONGODB_DATABASE_NAME = "csa-datastore"
